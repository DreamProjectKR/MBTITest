{
  "version": 3,
  "sources": ["../../src/scripts/legacy/testresult.js"],
  "sourcesContent": ["/**\n * Result page controller (`public/testresult.html` -> `public/scripts/testresult.js`).\n *\n * What it does:\n * - Reads `testId` and `code` from query string.\n * - Fetches outcome via `GET /api/tests/:id/outcome?code=...`.\n * - Renders `outcome.image`.\n * - Provides Restart + Share interactions.\n */\nconst dom = {\n  thumbnailEl: document.querySelector(\".ResultShellImg img\"),\n  titleEl: document.querySelector(\".ResultShellTextBox h2\"),\n  startBtn: document.querySelector(\".ResultBtnShell .Restart button\"),\n  shareBtn: document.querySelector(\".ResultBtnShell .TestShare button\"),\n};\n\n// `config.js` usually defines `window.ASSETS_BASE` and `window.assetUrl`.\n// Production default: same-origin `/assets/*` (served by Pages Functions proxy).\nconst ASSETS_BASE = window.ASSETS_BASE || \"\";\n/**\n * Build an absolute URL for an asset path under `assets/`.\n * @param {string} path\n * @returns {string}\n */\nconst assetUrl =\n  window.assetUrl ||\n  ((path) => {\n    if (!path) return \"\";\n    if (/^https?:\\/\\//i.test(path)) return path;\n    let clean = String(path).replace(/^\\.?\\/+/, \"\");\n    clean = clean.replace(/^assets\\/+/i, \"\");\n    return `${ASSETS_BASE}/${clean}`.replace(/\\/{2,}/g, \"/\");\n  });\n\nconst TEST_JSON_CACHE_PREFIX = \"mbtitest:testdata:\";\n\nfunction getTestCacheKey(testId) {\n  if (!testId) return \"\";\n  return `${TEST_JSON_CACHE_PREFIX}${testId}`;\n}\n\nfunction readCachedTestJson(testId) {\n  if (!testId || typeof window === \"undefined\") return null;\n  try {\n    const storage = window.sessionStorage;\n    if (!storage) return null;\n    const raw = storage.getItem(getTestCacheKey(testId));\n    if (!raw) return null;\n    return JSON.parse(raw);\n  } catch (err) {\n    return null;\n  }\n}\n\nfunction persistTestJson(testId, data) {\n  if (!testId || !data || typeof window === \"undefined\") return;\n  try {\n    const storage = window.sessionStorage;\n    if (!storage) return;\n    storage.setItem(getTestCacheKey(testId), JSON.stringify(data));\n  } catch (err) {\n    // Ignore private mode/quota issues\n  }\n}\n\n/**\n * Read a URL query parameter.\n * @param {string} name\n * @returns {string}\n */\nfunction getParam(name) {\n  const params = new URLSearchParams(window.location.search);\n  const value = params.get(name);\n  return value ? decodeURIComponent(value) : \"\";\n}\n\n/**\n * Resolve a relative asset path into an absolute URL for use in <img src>.\n * @param {string} relative\n * @returns {string}\n */\nfunction resolveAssetPath(relative) {\n  return assetUrl(relative);\n}\n\n/**\n * Render a user-visible error state.\n * @param {string} message\n */\nfunction renderError(message) {\n  if (dom.titleEl) dom.titleEl.textContent = \"\uACB0\uACFC\uB97C \uBD88\uB7EC\uC62C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.\";\n  if (dom.thumbnailEl) dom.thumbnailEl.removeAttribute(\"src\");\n}\n\nfunction setupButtons(testId, mbti, title) {\n  const restartUrl = `./testquiz.html?testId=${encodeURIComponent(testId)}`;\n\n  if (dom.startBtn) {\n    dom.startBtn.addEventListener(\"click\", () => {\n      window.location.href = restartUrl;\n    });\n  }\n\n  if (dom.shareBtn) {\n    dom.shareBtn.addEventListener(\"click\", () => {\n      shareResult({ mbti, title });\n    });\n  }\n}\n\nasync function shareResult({ mbti, title }) {\n  const shareUrl = window.location.href;\n  const shareTitle = title ? `${title} - ${mbti}` : `MBTI \uACB0\uACFC ${mbti}`;\n  if (navigator.share) {\n    await navigator.share({\n      title: shareTitle,\n      text: shareTitle,\n      url: shareUrl,\n    });\n    return;\n  }\n  await navigator.clipboard.writeText(shareUrl);\n  alert(\"\uB9C1\uD06C\uAC00 \uD074\uB9BD\uBCF4\uB4DC\uC5D0 \uBCF5\uC0AC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.\");\n}\n\nfunction renderResultPage(data, mbti) {\n  const code = mbti;\n  if (!data || !code) {\n    renderError(\"\uACB0\uACFC \uC815\uBCF4\uB97C \uBD88\uB7EC\uC624\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4.\");\n    return;\n  }\n\n  const resultData = data.outcome;\n  const resultImage = resolveAssetPath(resultData?.image);\n\n  if (dom.thumbnailEl) {\n    if (resultImage) dom.thumbnailEl.src = resultImage;\n    dom.thumbnailEl.alt = code ? `${code} \uACB0\uACFC` : \"\uACB0\uACFC \uC774\uBBF8\uC9C0\";\n  }\n\n  if (dom.titleEl) {\n    const titleText = data.title ? `${data.title} - ${code}` : `\uACB0\uACFC ${code}`;\n    dom.titleEl.textContent = titleText;\n    document.title = titleText;\n  }\n\n  setupButtons(data.id, code, data.title);\n}\n\nasync function loadResultData() {\n  const testId = getParam(\"testId\");\n  const mbti = (getParam(\"code\") || getParam(\"result\") || \"\").trim();\n\n  document.body.classList.add(\"ResultPage\");\n\n  if (!testId || !mbti) {\n    renderError(\"\uC798\uBABB\uB41C \uC811\uADFC\uC785\uB2C8\uB2E4. \uD14C\uC2A4\uD2B8\uC640 \uACB0\uACFC\uB97C \uD655\uC778\uD574\uC8FC\uC138\uC694.\");\n    return;\n  }\n\n  try {\n    const apiBase = window.API_TESTS_BASE || \"/api/tests\";\n    const url = new URL(`${apiBase}/${encodeURIComponent(testId)}/outcome`, window.location.href);\n    url.searchParams.set(\"code\", mbti);\n    const dataRes = await fetch(url.toString());\n    if (!dataRes.ok) throw new Error(\"\uD14C\uC2A4\uD2B8 \uB370\uC774\uD130 \uB85C\uB529 \uC2E4\uD328\");\n    const data = await dataRes.json();\n\n    renderResultPage(data, mbti);\n  } catch (err) {\n    console.error(\"\uACB0\uACFC \uD398\uC774\uC9C0 \uB85C\uB529 \uC624\uB958:\", err);\n    renderError(\"\uACB0\uACFC \uC815\uBCF4\uB97C \uBD88\uB7EC\uC624\uC9C0 \uBABB\uD588\uC2B5\uB2C8\uB2E4.\");\n  }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", loadResultData);\n"],
  "mappings": "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",
  "names": []
}

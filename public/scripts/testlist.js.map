{
  "version": 3,
  "sources": ["../../src/scripts/legacy/testlist.js"],
  "sourcesContent": ["/**\n * Test list page controller (`public/testlist.html` -> `public/scripts/testlist.js`).\n *\n * What it does:\n * - Fetches test metadata from `GET /api/tests`.\n * - Renders a grid of cards (4 per row).\n * - On click, navigates to `testintro.html?testId=...`.\n */\nconst header = document.getElementById(\"header\");\nconst headerScroll = document.getElementById(\"headerScroll\");\nconst MainTop = document.getElementById(\"MainTop\");\n// `config.js` usually defines `window.ASSETS_BASE` and `window.assetUrl`.\n// Production default: same-origin `/assets/*` (served by Pages Functions proxy).\nconst ASSETS_BASE = window.ASSETS_BASE || \"\";\n/**\n * Build an absolute URL for an asset path under `assets/`.\n * @param {string} path\n * @returns {string}\n */\nconst assetUrl =\n  window.assetUrl ||\n  ((path) => {\n    if (!path) return \"\";\n    if (/^https?:\\/\\//i.test(path)) return path;\n    let clean = String(path).replace(/^\\.?\\/+/, \"\");\n    clean = clean.replace(/^assets\\/+/i, \"\");\n    return `${ASSETS_BASE}/${clean}`.replace(/\\/{2,}/g, \"/\");\n  });\n\nconst headerOffset = header.offsetTop; // \uD5E4\uB354 \uC6D0\uB798 \uC704\uCE58 \uC800\uC7A5\n\nwindow.addEventListener(\"scroll\", () => {\n  const isMobile = window.matchMedia(\"(max-width: 900px)\").matches;\n  if (window.scrollY > headerOffset) {\n    header.classList.add(\"fixed-header\", \"bg-on\");\n    if (isMobile && headerScroll) {\n      headerScroll.style.marginBottom = \"45px\";\n    }\n  } else {\n    header.classList.remove(\"fixed-header\", \"bg-on\");\n    if (headerScroll) {\n      headerScroll.style.marginBottom = \"\";\n    }\n  }\n});\n\ndocument.querySelector(\".test1\").onclick = function () {\n  window.location.href = \"testintro.html\";\n};\n\n// index.json\uC744 AJAX\uB85C \uC77D\uC5B4\uC640 \uD14C\uC2A4\uD2B8 \uCE74\uB4DC \uBAA9\uB85D\uC744 \uAD6C\uC131\uD55C\uB2E4.\n(function () {\n  // ----- AJAX: /api/tests \uB85C\uB4DC -----\n  /**\n   * Fetch the test list used to build the cards.\n   * @returns {Promise<any[]>} Array of test metadata objects\n   */\n  async function fetchTestIndex() {\n    // D1-backed API is the source of truth.\n    const url = window.API_TESTS_BASE || \"/api/tests\";\n    const res = await fetch(url);\n    if (!res.ok) throw new Error(url + \" \uC694\uCCAD \uC2E4\uD328: \" + res.status);\n    const data = await res.json();\n    return Array.isArray(data?.tests) ? data.tests : [];\n  }\n\n  // ----- \uB370\uC774\uD130 \uC815\uADDC\uD654: \uC911\uBCF5 \uC81C\uAC70 + \uCD5C\uC2E0\uC21C \uC815\uB82C -----\n  /**\n   * De-duplicate and sort tests (newest first).\n   * @param {any[]} tests\n   * @returns {any[]}\n   */\n  function normalizeTests(tests) {\n    const seen = new Set();\n    const deduped = [];\n    tests.forEach((t) => {\n      const key = `${t.id}-${t.path}`;\n      if (seen.has(key)) return;\n      seen.add(key);\n      deduped.push(t);\n    });\n    deduped.sort((a, b) => {\n      const ad = new Date(a.updatedAt || a.createdAt || 0);\n      const bd = new Date(b.updatedAt || b.createdAt || 0);\n      return bd - ad; // \uCD5C\uC2E0 \uBA3C\uC800\n    });\n    return deduped;\n  }\n\n  // ----- \uC378\uB124\uC77C \uACBD\uB85C \uBCF4\uC815 -----\n  /**\n   * Convert thumbnail path from API into a URL usable by <img src>.\n   * @param {string} thumbnail\n   * @returns {string}\n   */\n  function resolveThumbnailPath(thumbnail, resizeOptions = {}) {\n    if (!thumbnail) return \"#\";\n    if (/^https?:\\/\\//i.test(thumbnail)) return thumbnail;\n    if (window.assetResizeUrl) {\n      return window.assetResizeUrl(thumbnail, resizeOptions);\n    }\n    return assetUrl(thumbnail);\n  }\n\n  const warmedImageUrls = new Set();\n\n  function preloadImage(url) {\n    if (!url || warmedImageUrls.has(url) || typeof document === \"undefined\") return;\n    const link = document.createElement(\"link\");\n    link.rel = \"preload\";\n    link.as = \"image\";\n    link.href = url;\n    document.head.appendChild(link);\n    warmedImageUrls.add(url);\n  }\n\n  function prefetchImage(url) {\n    if (!url || warmedImageUrls.has(url)) return;\n    const img = new Image();\n    img.decoding = \"async\";\n    img.src = url;\n    warmedImageUrls.add(url);\n  }\n\n  function warmCriticalImages(tests) {\n    const heroPaths = [\n      \"assets/images/HeaderBackgroundImg.png\",\n      \"assets/images/HeaderBackgroundImgNon.png\",\n      \"assets/images/FooterBackgroundImg.png\",\n    ];\n    heroPaths.forEach((path) => {\n      const resized = window.assetResizeUrl\n        ? window.assetResizeUrl(path, { width: 1600, quality: 85 })\n        : assetUrl(path);\n      preloadImage(resized);\n    });\n\n    tests.slice(0, 4).forEach((test) => {\n      const thumbUrl = resolveThumbnailPath(test.thumbnail, {\n        width: 780,\n        quality: 90,\n        fit: \"cover\",\n      });\n      prefetchImage(thumbUrl);\n    });\n  }\n\n  // ----- \uD0DC\uADF8 DOM \uC0DD\uC131 -----\n  /**\n   * Build hashtag DOM nodes (up to 3 tags).\n   * @param {string[]} tags\n   * @returns {DocumentFragment}\n   */\n  function buildTags(tags) {\n    const frag = document.createDocumentFragment();\n    if (!Array.isArray(tags)) return frag;\n    tags.slice(0, 3).forEach((tag) => {\n      const span = document.createElement(\"span\");\n      span.className = \"HashTag\";\n      span.textContent = `#${tag}`;\n      frag.appendChild(span);\n    });\n    return frag;\n  }\n\n  // ----- \uCE74\uB4DC DOM \uC0DD\uC131 -----\n  /**\n   * Build a single test card.\n   * @param {any} test\n   * @param {{ isFirst?: boolean }} [opts]\n   */\n  function buildCard(test, opts = {}) {\n    const shell = document.createElement(\"div\");\n    shell.className = \"NewTestShell\";\n\n    const card = document.createElement(\"div\");\n    card.className = \"NewTest\";\n\n    const img = document.createElement(\"img\");\n    const sizeOptions = {\n      width: opts.isFirst ? 780 : 520,\n      quality: opts.isFirst ? 90 : 78,\n      fit: \"cover\",\n    };\n    img.src = resolveThumbnailPath(test.thumbnail, sizeOptions);\n    img.alt = test.title || \"\uD14C\uC2A4\uD2B8 \uC774\uBBF8\uC9C0\";\n    img.decoding = \"async\";\n    // First card is most likely above the fold: prioritize it.\n    if (opts.isFirst) {\n      try {\n        img.loading = \"eager\";\n      } catch (e) {}\n      try {\n        img.fetchPriority = \"high\";\n      } catch (e) {}\n      try {\n        img.setAttribute(\"fetchpriority\", \"high\");\n      } catch (e) {}\n    } else {\n      // Avoid competing with LCP for offscreen cards.\n      try {\n        img.loading = \"lazy\";\n      } catch (e) {}\n    }\n\n    const title = document.createElement(\"h4\");\n    title.textContent = test.title || \"\uD14C\uC2A4\uD2B8 \uC774\uB984\";\n\n    const tagBox = document.createElement(\"div\");\n    tagBox.className = \"NewTestHashTag\";\n    tagBox.appendChild(buildTags(test.tags));\n\n    card.appendChild(img);\n    card.appendChild(title);\n    card.appendChild(tagBox);\n    shell.appendChild(card);\n\n    shell.onclick = () => {\n      const dest = `testintro.html?testId=${encodeURIComponent(test.id || \"\")}`;\n      window.location.href = dest;\n    };\n\n    return shell;\n  }\n\n  // ----- 4\uAC1C\uC529 \uD589(row)\uC73C\uB85C \uB80C\uB354\uB9C1 -----\n  function renderTests(tests) {\n    const root = document.querySelector(\".NewTestList\");\n    if (!root) return;\n\n    root.innerHTML = \"\";\n\n    const chunkSize = 4;\n    let rendered = 0;\n    for (let i = 0; i < tests.length; i += chunkSize) {\n      const row = document.createElement(\"div\");\n      row.className = \"NewTestListShell\";\n\n      tests.slice(i, i + chunkSize).forEach((test) => {\n        const isFirst = rendered === 0;\n        row.appendChild(buildCard(test, { isFirst }));\n        rendered += 1;\n      });\n\n      root.appendChild(row);\n    }\n  }\n\n  // ----- \uCD08\uAE30 \uAD6C\uB3D9 -----\n  function initTestList() {\n    fetchTestIndex()\n      .then(normalizeTests)\n      .then((tests) => {\n        renderTests(tests);\n        warmCriticalImages(tests);\n      })\n      .catch((err) => console.error(\"\uD14C\uC2A4\uD2B8 \uBAA9\uB85D \uB85C\uB529 \uC2E4\uD328:\", err));\n  }\n\n  document.addEventListener(\"DOMContentLoaded\", initTestList);\n})();\n"],
  "mappings": "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",
  "names": []
}
